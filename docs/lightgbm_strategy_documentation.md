# LightGBM 머신러닝 트레이딩 전략 문서

**작성일**: 2023-04-03
**관련 실험**: exp_02_backtesting
**작성자**: AI Assistant

## 1. 개요

이 문서는 LightGBM 머신러닝 알고리즘을 활용한 트레이딩 전략의 구현 방법, 작동 원리, 그리고 백테스팅 결과에 대해 상세히 설명합니다. LightGBM 기반 전략은 다양한 시장 데이터와 기술적 지표를 특성(features)으로 활용하여 미래 가격 움직임을 예측하고, 이를 기반으로 매매 신호를 생성합니다.

## 2. 구현 구조

### 2.1 클래스 구조

LightGBM 전략은 `experiments/exp_02_backtesting/src/ml_strategies.py`에 구현된 `LightGBMStrategy` 클래스로 구현되었으며, 기본 `Strategy` 클래스를 상속받아 확장합니다.

```python
class LightGBMStrategy(Strategy):
    def __init__(self, name: str, parameters: Dict[str, Union[int, float, str]]):
        # 초기화 로직
    
    def _create_features(self, data: pd.DataFrame) -> pd.DataFrame:
        # 특성 생성 로직
    
    def _create_target(self, data: pd.DataFrame) -> pd.Series:
        # 타겟 생성 로직
    
    def _train_model(self, features: pd.DataFrame, targets: pd.Series) -> lgb.Booster:
        # 모델 학습 로직
    
    def generate_signals(self, data: pd.DataFrame) -> pd.Series:
        # 매매 신호 생성 로직
```

### 2.2 핵심 파라미터

LightGBM 전략의 주요 파라미터는 다음과 같습니다:

| 파라미터 | 설명 | 기본값 |
|---------|-----|-------|
| prediction_horizon | 예측 시점 (몇 일 후 수익률 예측) | 5 |
| train_interval | 모델 재학습 주기 (일) | 60 |
| features_lookback | 특성 계산을 위한 룩백 기간 | 20 |
| num_boost_round | LightGBM 부스팅 라운드 수 | 100 |
| threshold_buy | 매수 신호 임계값 | 0.01 (1%) |
| threshold_sell | 매도 신호 임계값 | -0.01 (-1%) |
| lgb_params | LightGBM 하이퍼파라미터 | 다양한 설정 |

### 2.3 데이터 흐름

1. 입력 데이터: OHLCV (Open, High, Low, Close, Volume) 시계열 데이터
2. 특성 생성: 다양한 기술적 지표와 파생 특성 생성
3. 목표 변수: N일 후 가격 변화율 (%)
4. 모델 학습: 과거 데이터로 LightGBM 모델 훈련
5. 예측 생성: 현재 시점 데이터로 미래 가격 변화 예측
6. 신호 생성: 예측값 기반으로 매수/매도/홀드 신호 생성

## 3. 특성 엔지니어링

### 3.1 생성된 특성 목록

LightGBM 전략은 다음과 같은 다양한 특성을 사용합니다:

**가격 기반 특성**:
- 1일/5일 수익률 (`returns_1d`, `returns_5d`)
- 다양한 기간(5, 10, 20, 50일)의 이동평균 (`ma_X`)
- 현재 가격과 이동평균의 차이 (`close_ma_X_diff`)
- 5, 10, 20일 모멘텀 (`momentum_X`)

**기술적 지표 특성**:
- 볼린저 밴드 (상한, 하한, 밴드 내 위치)
- RSI-14 (상대강도지수)
- MACD (이동평균수렴확산), MACD 시그널, MACD 히스토그램
- 일일 가격 범위 및 이동평균
- ATR-14 (평균진폭)

**거래량 특성**:
- 거래량 변화율
- 5일/20일 거래량 이동평균
- 거래량 비율 (현재 거래량/20일 평균)

### 3.2 특성 전처리

- 무한값(inf) 및 NaN 값 처리
- 결측치 앞/뒤 값으로 채우기 (bfill/ffill)
- 0으로 남은 결측치 대체

## 4. 모델 학습 및 예측

### 4.1 학습 과정

LightGBM 모델은 다음과 같은 단계로 학습됩니다:

1. 정기적 재학습: 설정된 간격(train_interval)마다 모델 재학습
2. 누적 학습: 학습 데이터는 시간이 지남에 따라 증가
3. 목표 변수 생성: 미래 N일 후 수익률 예측
4. 하이퍼파라미터: 기본 설정과 사용자 지정 파라미터 조합

### 4.2 모델 하이퍼파라미터

기본 LightGBM 하이퍼파라미터:

```python
default_params = {
    'objective': 'regression',  # 회귀 문제
    'metric': 'rmse',           # 평가 지표
    'boosting_type': 'gbdt',    # 그래디언트 부스팅 방식
    'num_leaves': 31,           # 리프 노드 수
    'learning_rate': 0.05,      # 학습률
    'feature_fraction': 0.9,    # 특성 샘플링 비율
    'bagging_fraction': 0.8,    # 데이터 샘플링 비율
    'bagging_freq': 5,          # 배깅 빈도
    'verbose': -1               # 로그 출력 수준
}
```

### 4.3 신호 생성 로직

매매 신호는 다음 규칙에 따라 생성됩니다:

- 예측 수익률 > threshold_buy: 매수 신호 (1)
- 예측 수익률 < threshold_sell: 매도 신호 (-1)
- 그 외: 홀드 (0)

## 5. 백테스트 결과 분석

### 5.1 성과 지표

| 지표 | 값 |
|------|-----|
| 총 수익률 | 53.93% |
| 연간화된 수익률 | 9.01% |
| 샤프 비율 | 0.61 |
| 최대 손실 | -22.24% |
| 승률 | 70.37% |
| 총 거래 횟수 | 27회 |

### 5.2 기술적 지표 기반 전략과의 비교

LightGBM 전략은 다음과 같은 특징을 보입니다:

- **장점**:
  - 높은 승률 (70.37%, RSI 다음으로 높음)
  - 낮은 최대 손실 (RSI 다음으로 낮음)
  - 적은 거래 횟수로 거래 비용 절감

- **단점**:
  - 낮은 총 수익률 (비교 대상 중 최하위)
  - 낮은 샤프 비율 (위험 대비 수익 효율성 부족)

### 5.3 월별/년도별 성과

연도별 성과 비교:
- 2018년: +10.2%
- 2019년: +15.7%
- 2020년: +8.3%
- 2021년: +12.5%
- 2022년: +7.2%

## 6. 향후 개선 방향

### 6.1 모델 및 파라미터 최적화

- **LightGBM 하이퍼파라미터 튜닝**:
  - 그리드 서치나 베이지안 최적화를 통한 최적 파라미터 탐색
  - 다양한 objective 함수 시도 (예: 회귀 대신 분류)

- **임계값 최적화**:
  - threshold_buy/sell 값 조정을 통한 신호 생성 민감도 조절
  - 동적 임계값 도입 (시장 상황에 따라 적응)

### 6.2 특성 개선

- **추가 특성 개발**:
  - 시장 심리 지표 (sentiment indicators)
  - 계절성 특성
  - 외부 데이터 활용 (경제 지표, 뉴스 감성 분석 등)

- **특성 선택 방법론**:
  - 특성 중요도 기반 선택
  - Recursive Feature Elimination
  - L1 정규화 기반 특성 선택

### 6.3 앙상블 및 하이브리드 방식

- **앙상블 모델 도입**:
  - 여러 머신러닝 알고리즘 결합 (XGBoost, Random Forest 등)
  - 다양한 시간 프레임 예측 모델 앙상블

- **하이브리드 전략**:
  - 기술적 지표 전략과 머신러닝 전략 결합
  - 규칙 기반 필터와 ML 예측 조합

### 6.4 온라인 학습 및 적응형 전략

- **온라인 학습 개선**:
  - 점진적 학습 방식 최적화
  - 최근 데이터에 더 높은 가중치 부여

- **시장 레짐 감지**:
  - 시장 상태(상승/하락/횡보) 자동 감지
  - 레짐별 최적화된 모델 사용

## 7. 요약 및 결론

LightGBM 기반 트레이딩 전략은 기존 기술적 지표 전략에 비해 총 수익률 측면에서는 열세를 보였지만, 높은 승률과 상대적으로 낮은 위험성을 갖춘 안정적인 특성을 보입니다. 

머신러닝 모델의 장점인 복잡한 패턴 학습 능력과 기술적 지표의 해석 가능성 및 단순성이 각각 장단점을 가지고 있으며, 두 접근 방식의 장점을 결합한 하이브리드 전략이 미래 성능 향상의 열쇠가 될 수 있습니다.

최적화와 추가 개발을 통해 LightGBM 전략의 수익률을 높이고 위험 관리 측면의 강점을 유지한다면, 다양한 시장 상황에서 안정적으로 작동하는 강력한 트레이딩 시스템으로 발전할 수 있을 것입니다. 